<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.58.2 with theme Tranquilpeak 0.4.7-BETA">
<meta name="author" content="Giuliano Sposito">
<meta name="keywords" content="">
<meta name="description" content="



Operações Long-Short por Cointegração é uma estratégia de investimento em ativos que consiste em encontrar pares de ações (índices ou commodities) que mantém um padrão de comportamento estável e previsível (equilíbrio estacionário) com variações de curto prazo que permita ser explorado em operações de Long (compra) e Short (venda) do par. Este R-Notebook refaz o passo-a-passo nas análises estatísticas necessárias para detectar e operação essa estratégia de mercado.
">


<meta property="og:description" content="



Operações Long-Short por Cointegração é uma estratégia de investimento em ativos que consiste em encontrar pares de ações (índices ou commodities) que mantém um padrão de comportamento estável e previsível (equilíbrio estacionário) com variações de curto prazo que permita ser explorado em operações de Long (compra) e Short (venda) do par. Este R-Notebook refaz o passo-a-passo nas análises estatísticas necessárias para detectar e operação essa estratégia de mercado.
">
<meta property="og:type" content="article">
<meta property="og:title" content="Operações Long-Short através de Cointegração usando R">
<meta name="twitter:title" content="Operações Long-Short através de Cointegração usando R">
<meta property="og:url" content="/2018/08/operando-long-short-usando-cointegracao-em-r/">
<meta property="twitter:url" content="/2018/08/operando-long-short-usando-cointegracao-em-r/">
<meta property="og:site_name" content="Yet Another Iteration">
<meta property="og:description" content="



Operações Long-Short por Cointegração é uma estratégia de investimento em ativos que consiste em encontrar pares de ações (índices ou commodities) que mantém um padrão de comportamento estável e previsível (equilíbrio estacionário) com variações de curto prazo que permita ser explorado em operações de Long (compra) e Short (venda) do par. Este R-Notebook refaz o passo-a-passo nas análises estatísticas necessárias para detectar e operação essa estratégia de mercado.
">
<meta name="twitter:description" content="



Operações Long-Short por Cointegração é uma estratégia de investimento em ativos que consiste em encontrar pares de ações (índices ou commodities) que mantém um padrão de comportamento estável e previsível (equilíbrio estacionário) com variações de curto prazo que permita ser explorado em operações de Long (compra) e Short (venda) do par. Este R-Notebook refaz o passo-a-passo nas análises estatísticas necessárias para detectar e operação essa estratégia de mercado.
">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2018-08-26T00:00:00">
  
  
    <meta property="article:modified_time" content="2018-08-26T00:00:00">
  
  
  
    
      <meta property="article:section" content="data science">
    
  
  
    
      <meta property="article:tag" content="evalutation">
    
      <meta property="article:tag" content="long short">
    
      <meta property="article:tag" content="model">
    
      <meta property="article:tag" content="pair trading">
    
      <meta property="article:tag" content="rstats">
    
      <meta property="article:tag" content="stock market">
    
      <meta property="article:tag" content="pt-BR">
    
  


<meta name="twitter:card" content="summary">

  <meta name="twitter:site" content="@gsposito">


  <meta name="twitter:creator" content="@gsposito">






  <meta property="og:image" content="/images/coint_tn.png">
  <meta property="twitter:image" content="/images/coint_tn.png">


  <meta property="og:image" content="/images/coint_cover.png">
  <meta property="twitter:image" content="/images/coint_cover.png">




  <meta property="og:image" content="https://www.gravatar.com/avatar/2adfb1930aa9591ea756b0d94ca3603b?s=640">
  <meta property="twitter:image" content="https://www.gravatar.com/avatar/2adfb1930aa9591ea756b0d94ca3603b?s=640">


    <title>Operações Long-Short através de Cointegração usando R</title>

    <link rel="icon" href="/favicon.png">
    

    
      <link rel="publisher" href="https://plus.google.com/&#43;giulianosposito">
    

    <link rel="canonical" href="/2018/08/operando-long-short-usando-cointegracao-em-r/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="/css/style-twzjdbqhmnnacqs0pwwdzcdbt8yhv8giawvjqjmyfoqnvazl0dalmnhdkvp7.min.css" />
    
    

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-112393378-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="5">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="/">Yet Another Iteration</a>
  </div>
  
    
      <a class="header-right-picture "
         href="/#about">
    
    
    
      
        <img class="header-picture" src="https://www.gravatar.com/avatar/2adfb1930aa9591ea756b0d94ca3603b?s=90" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="5">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="/#about">
          <img class="sidebar-profile-picture" src="https://www.gravatar.com/avatar/2adfb1930aa9591ea756b0d94ca3603b?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Giuliano Sposito</h4>
        
          <h5 class="sidebar-profile-bio">Computer Engineer<br/>Masters in Tech Innovation Mgt<br/>Specialized in Data Science</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/about">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/giulsposito">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/gsposito">
    
      <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      
  <div class="post-header-cover
              text-center
              "
       style="background-image:url('/images/coint_cover.png')"
       data-behavior="5">
    
      <div class="post-header main-content-wrap text-center">
  
    <h1 class="post-title" itemprop="headline">
      Operações Long-Short através de Cointegração usando R
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2018-08-26T00:00:00Z">
        
  August 26, 2018

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="/categories/data-science">data science</a>
    
  

  </div>

</div>
    
  </div>


      <div id="main" data-behavior="5"
        class="hasCover
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <div id="introducao" class="section level2">
<h2>Introdução</h2>
<p>A ideia tradicional de uma reversão de “<em>Pair Trading</em>” é encontrar dois ativos distintos, compartilhando fatores subjacentes que afetam seus movimentos, por exemplo, McDonald’s e Burger King. Os preços das ações de longo prazo provavelmente estarão em equilíbrio devido aos amplos fatores de mercado que afetam a produção e o consumo de hambúrguer. Uma interrupção de curto prazo para um indivíduo no par, como uma interrupção na cadeia de fornecimento que afeta apenas o McDonald’s, levaria a um deslocamento temporário em seus preços relativos.</p>
<p>Isso significa que uma negociação de curto prazo realizada nesse ponto de interrupção deve se tornar lucrativa, pois as duas ações retornam ao seu valor de equilíbrio assim que a interrupção for resolvida.</p>
<p>Encontrar pares de ativos ou índices que se comportem desta maneira possibilita abrir operações Long (compra) e short (venda) simultâneas quando os ativos se “afastam” momentaneamente do movimento conjunto, e se encerra quando elas retornam para o padrão. Ganha-se então com a variação da diferença (ou a distância) entre os dois.</p>
</div>
<div id="analise-de-cointegracao-usando-r" class="section level2">
<h2>Análise de Cointegração usando R</h2>
<p>Análise de Cointegração e Operação Long-Short consiste sumariamente em:</p>
<ol style="list-style-type: decimal">
<li>Identificar uma relação histórica entre dois ativos, ou seja, quando um sobe o outro sobe, quando um cai o outro cai (em termos percentuais fica fácil);</li>
<li>Visualizar um momento em que há uma divergência neste percentual entre os dois ativos;</li>
<li>Compra A e vende B (aluga e vende);</li>
<li>Ao retornar para o percentual histórico desejado desfaz a operação, ou seja, compra B e vende A.</li>
</ol>
<p>O ideal ao se fazer o Long/Short é que ele seja feito no mesmo financeiro (<em>cash-neutro</em>). Neste caso, não há a preocupação se a bolsa sobe ou desce, o que importa é a relação percentual, pois vai se estar atuando nas duas pontas (compra e venda). Além disso, praticamente não há desembolso financeiro, pois o valor da venda do ativo alugado será utilizado para a compra (há apenas a margem da CBLC ou da corretora (se for maior). E ainda dá para alavancar a carteira.</p>
<div id="caso-de-exemplo-qual3-e-rent3" class="section level3">
<h3>Caso de Exemplo: QUAL3 e RENT3</h3>
<p>Este notebook tem o objetivo de reproduzir o passo-a-passo para detectar e avaliar pares de ativos <a href="https://en.wikipedia.org/wiki/Cointegration">cointegrados</a> mostrado no <a href="https://drnickel.wordpress.com/2015/04/03/long-short-atraves-de-cointegracao-parte-3/">blog do Dr. Nickel</a>.
Muitos dos textos explicativos aqui foram retirados (ou fortemente baseados) na série de posts sobre Cointegração explicando o processo de análise, portando vale a pena ler a série toda, bem mais detalhada e com ótimas referências:</p>
<ol style="list-style-type: decimal">
<li><a href="https://drnickel.wordpress.com/2015/03/15/long-short-atraves-de-cointegracao-parte-1/">Long-Short através de Cointegração – Parte 1</a></li>
<li><a href="https://drnickel.wordpress.com/2015/03/15/long-short-atraves-de-cointegracao-parte-2/">Long-Short através de Cointegração – Parte 2</a></li>
<li><a href="https://drnickel.wordpress.com/2015/04/03/long-short-atraves-de-cointegracao-parte-3/">Long-Short através de Cointegração – Parte 3</a></li>
<li><a href="https://drnickel.wordpress.com/2016/11/05/long-short-atraves-de-cointegracao-parte-4/">Long-Short através de Cointegração – Parte 4</a></li>
</ol>
</div>
<div id="dataset" class="section level3">
<h3>Dataset</h3>
<p>No poste ele faz faz uma análise dos ativos <a href="https://www.infomoney.com.br/qualicorp-qual3"><strong>QUAL3</strong> - QUALICORP ON</a> e <a href="https://www.infomoney.com.br/localiza-rent3"><strong>RENT3</strong> - Localiza ON</a> usando uma <a href="https://drnickel.files.wordpress.com/2015/04/exemplos-cointegracao-qual3_rent32.xlsx">planilha excel</a>, neste notebook refaço o procedimento usando R. Para garantir que os resultados obtidos em ambas sejam os mesmos usaremos exatamente os mesmo dados que constam na planilha.</p>
<div class="figure">
<img src="/images/excel_data.png" alt="Cotações de QUAL3 e RENT3 no Excel" />
<p class="caption">Cotações de QUAL3 e RENT3 no Excel</p>
</div>
<p>Após a importação, obtemos:</p>
<pre class="r"><code># data handlers
library(tidyverse)
library(lubridate)

# table formatting
library(kableExtra)

# loading data
library(xlsx)
xls &lt;- read.xlsx(&quot;./exemplos-cointegracao-qual3_rent32.xlsx&quot;,2) 

# O que nos importamos?
xls %&gt;%
  select(-`NA..4`) %&gt;%  # esta coluna estraga a formatacao da tabela
  head(10) %&gt;% 
  kable(caption=&quot;Excel Importado&quot;) %&gt;%
  kable_styling(bootstrap_options = &quot;striped&quot;, full_width = F)</code></pre>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:loadData">Table 1: </span>Excel Importado
</caption>
<thead>
<tr>
<th style="text-align:left;">
Data
</th>
<th style="text-align:left;">
QUAL3
</th>
<th style="text-align:left;">
NA.
</th>
<th style="text-align:left;">
NA..1
</th>
<th style="text-align:left;">
RENT3
</th>
<th style="text-align:left;">
NA..2
</th>
<th style="text-align:left;">
NA..3
</th>
<th style="text-align:left;">
NA..5
</th>
<th style="text-align:left;">
NA..6
</th>
<th style="text-align:left;">
NA..7
</th>
<th style="text-align:left;">
NA..8
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Preco
</td>
<td style="text-align:left;">
Lag
</td>
<td style="text-align:left;">
Delta
</td>
<td style="text-align:left;">
Preco
</td>
<td style="text-align:left;">
Lag
</td>
<td style="text-align:left;">
Delta
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
2012-10-10
</td>
<td style="text-align:left;">
19.65
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
31.953
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
2012-10-11
</td>
<td style="text-align:left;">
19.7
</td>
<td style="text-align:left;">
19.65
</td>
<td style="text-align:left;">
0.0500000000000007
</td>
<td style="text-align:left;">
32.232
</td>
<td style="text-align:left;">
31.953
</td>
<td style="text-align:left;">
0.279
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
2012-10-15
</td>
<td style="text-align:left;">
19.87
</td>
<td style="text-align:left;">
19.7
</td>
<td style="text-align:left;">
0.170000000000002
</td>
<td style="text-align:left;">
32.124
</td>
<td style="text-align:left;">
32.232
</td>
<td style="text-align:left;">
-0.107999999999997
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
2012-10-16
</td>
<td style="text-align:left;">
19.35
</td>
<td style="text-align:left;">
19.87
</td>
<td style="text-align:left;">
-0.52
</td>
<td style="text-align:left;">
31.584
</td>
<td style="text-align:left;">
32.124
</td>
<td style="text-align:left;">
-0.540000000000003
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
2012-10-17
</td>
<td style="text-align:left;">
18.75
</td>
<td style="text-align:left;">
19.35
</td>
<td style="text-align:left;">
-0.600000000000001
</td>
<td style="text-align:left;">
30.594
</td>
<td style="text-align:left;">
31.584
</td>
<td style="text-align:left;">
-0.989999999999998
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
2012-10-18
</td>
<td style="text-align:left;">
18.87
</td>
<td style="text-align:left;">
18.75
</td>
<td style="text-align:left;">
0.120000000000001
</td>
<td style="text-align:left;">
31.134
</td>
<td style="text-align:left;">
30.594
</td>
<td style="text-align:left;">
0.539999999999999
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
2012-10-19
</td>
<td style="text-align:left;">
19
</td>
<td style="text-align:left;">
18.87
</td>
<td style="text-align:left;">
0.129999999999999
</td>
<td style="text-align:left;">
31.215
</td>
<td style="text-align:left;">
31.134
</td>
<td style="text-align:left;">
0.0809999999999995
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
2012-10-22
</td>
<td style="text-align:left;">
19.2
</td>
<td style="text-align:left;">
19
</td>
<td style="text-align:left;">
0.199999999999999
</td>
<td style="text-align:left;">
31.512
</td>
<td style="text-align:left;">
31.215
</td>
<td style="text-align:left;">
0.297000000000001
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
2012-10-23
</td>
<td style="text-align:left;">
19.15
</td>
<td style="text-align:left;">
19.2
</td>
<td style="text-align:left;">
-0.0500000000000007
</td>
<td style="text-align:left;">
31.512
</td>
<td style="text-align:left;">
31.512
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table>
<p>Como o Excel não está adequadamente formatado (há células colapsadas e colunas vazias entre os dados) e acabamos com um dado importado muito sujo, há necessidade de limpar, <em>tipar</em> e arrumar
<a href="http://r4ds.had.co.nz/tidy.html">(data tidying)</a>, deixando-os simples de manipular.</p>
<pre class="r"><code># limpando e arrumando (tidying)
# primeiro isola o QUAL3
xls %&gt;% 
  as.tibble() %&gt;% 
  select( ref.date = Data, price.close=QUAL3 ) %&gt;% 
  filter( complete.cases(.) ) %&gt;% 
  mutate( ticker=&quot;QUAL3&quot;,
          price.close = as.numeric(as.character(price.close)) ) -&gt; qual


# despois o RENT3
xls %&gt;% 
  as.tibble() %&gt;% 
  select( ref.date = Data, price.close=RENT3 ) %&gt;% 
  filter( complete.cases(.) ) %&gt;% 
  mutate( ticker=&quot;RENT3&quot;,
          price.close = as.numeric(as.character(price.close)) ) -&gt; rent

# Junta ambos
df.tickers = bind_rows(qual,rent)

# ficou melhor
df.tickers %&gt;% 
  arrange(ref.date) %&gt;% 
  head(10) %&gt;% 
  kable(caption=&quot;Dados &#39;Tidy&#39; &quot;) %&gt;%
  kable_styling(bootstrap_options = &quot;striped&quot;, full_width = F)</code></pre>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:tidyingTickers">Table 2: </span>Dados ‘Tidy’
</caption>
<thead>
<tr>
<th style="text-align:left;">
ref.date
</th>
<th style="text-align:right;">
price.close
</th>
<th style="text-align:left;">
ticker
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2012-10-10
</td>
<td style="text-align:right;">
19.650
</td>
<td style="text-align:left;">
QUAL3
</td>
</tr>
<tr>
<td style="text-align:left;">
2012-10-10
</td>
<td style="text-align:right;">
31.953
</td>
<td style="text-align:left;">
RENT3
</td>
</tr>
<tr>
<td style="text-align:left;">
2012-10-11
</td>
<td style="text-align:right;">
19.700
</td>
<td style="text-align:left;">
QUAL3
</td>
</tr>
<tr>
<td style="text-align:left;">
2012-10-11
</td>
<td style="text-align:right;">
32.232
</td>
<td style="text-align:left;">
RENT3
</td>
</tr>
<tr>
<td style="text-align:left;">
2012-10-15
</td>
<td style="text-align:right;">
19.870
</td>
<td style="text-align:left;">
QUAL3
</td>
</tr>
<tr>
<td style="text-align:left;">
2012-10-15
</td>
<td style="text-align:right;">
32.124
</td>
<td style="text-align:left;">
RENT3
</td>
</tr>
<tr>
<td style="text-align:left;">
2012-10-16
</td>
<td style="text-align:right;">
19.350
</td>
<td style="text-align:left;">
QUAL3
</td>
</tr>
<tr>
<td style="text-align:left;">
2012-10-16
</td>
<td style="text-align:right;">
31.584
</td>
<td style="text-align:left;">
RENT3
</td>
</tr>
<tr>
<td style="text-align:left;">
2012-10-17
</td>
<td style="text-align:right;">
18.750
</td>
<td style="text-align:left;">
QUAL3
</td>
</tr>
<tr>
<td style="text-align:left;">
2012-10-17
</td>
<td style="text-align:right;">
30.594
</td>
<td style="text-align:left;">
RENT3
</td>
</tr>
</tbody>
</table>
<p>Com o <em>dataset</em> mais organizado, vamos visualizar os preços dos ativos importados.</p>
<pre class="r"><code># plota o preco dos ativos
library(ggplot2)
ggplot(df.tickers,aes(x=ref.date, y=price.close, color=ticker)) +
  geom_line(size=1) + theme_light()</code></pre>
<p><img src="/post/2018-08-26-operando-long-short-usando-cointegracao-em-r_files/figure-html/tickersPlot-1.png" width="672" /></p>
</div>
<div id="series-nao-estacionarias" class="section level3">
<h3>Séries Não Estacionárias</h3>
<p>O primeiro passo é testar se cada uma das séries é não-estacionária, aplicando o teste <a href="https://en.wikipedia.org/wiki/Dickey%E2%80%93Fuller_test">Dickey-Fuller</a> em cada série de preços. A hipótese nula do teste DF é que a série é não-estacionária, portanto neste primeiro teste queremos que a hipótese nula não seja rejeitada.</p>
<p>Para aplicar o teste DF, precisamos primeiro calcular os valores defasados (<code>lags</code>) de cada série e o <code>delta</code> (diferença entre o preço do dia e o preço do dia anterior) e após isto fazer regressão do <code>delta</code> em função do <code>lag</code>:</p>
<p><span class="math display">\[\Delta P_{t} = \alpha + \beta P_{t-1} + \epsilon\]</span></p>
<p>Após fazer a regressão, o valor chave a ser usado para determinar se a série é não estacionária é o <a href="https://dss.princeton.edu/online_help/analysis/interpreting_regression.htm"><code>t-statistic</code></a> do coeficiente <span class="math inline">\(\beta\)</span> obtido, que é o valor do coeficiente dividido pelo desvio padrão. Pode ser pensado como uma medida da precisão com que o coeficiente de regressão é medido. Se um coeficiente é grande comparado ao seu erro padrão, provavelmente é diferente de 0. Esse valor então é confrontado contra uma tabela de referência, que determinará se a série é estacionária ou não.</p>
<div class="figure">
<img src="/images/dickey-fuller-table.png" alt="Dickey-Fuller Table" />
<p class="caption">Dickey-Fuller Table</p>
</div>
<p>O valor de referência é sensível ao número de pontos usados na regressão. Assim sendo, vamos fazer o <em>fit</em> da regressão linear e obter os valores de referência desta regressão</p>
<pre class="r"><code># esta funcao calcula o delta e o &quot;lag&quot; e entao fit e devolve um modelo
fitLagModel &lt;- function(dtf){
  # pega os datasets de precos de um ticker
  dtf %&gt;% 
    select( price.close ) %&gt;% # so interessa o preco de fechametno
    mutate( price.lag = lag(price.close,1), # cria um &quot;lag&quot; de um dia
            price.delta = price.close - price.lag ) %&gt;%  # delta entre fechamento e lag
    filter( complete.cases(.) ) %&gt;% # elimina valores vazios
    lm( price.lag ~ price.delta, . ) %&gt;% # fita o modelo
    return()
}

# tidyfica alguns parametros do modelo
library(broom)

# testes de series estacionarias
# para cada ticker fita o modelo linear
df.tickers %&gt;%
  group_by(ticker) %&gt;%
  nest() %&gt;% 
  mutate ( lagModel = map(data, fitLagModel), # modelo liner do &quot;lag x delta&quot;
           lm.coefs  = map(lagModel,tidy),    # coeficientes obtidos do modelo
           lm.glance = map(lagModel, glance), # qualidade do fit
           lm.anova  = map(lagModel, anova),  # analise de variancia do modelo
           lm.anova  = map(lm.anova, tidy)) -&gt; stat.test</code></pre>
<p>Então para cada um dos <em>ticker</em>, temos um <em>dataset</em> com as cotações, o modelo fitado, dados dos coeficientes, análise de variação e qualidade do <em>fit</em>. Vamos olhar o valor para cada uma das séries.</p>
<pre class="r"><code># visualizando a qualidade do fit
stat.test %&gt;% 
  select(ticker, lm.glance) %&gt;% 
  unnest(lm.glance) %&gt;% 
  kable(caption = &quot;Qualidade da regressão&quot;) %&gt;%
  kable_styling(bootstrap_options = &quot;striped&quot;, full_width = F)</code></pre>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:fitQuality">Table 3: </span>Qualidade da regressão
</caption>
<thead>
<tr>
<th style="text-align:left;">
ticker
</th>
<th style="text-align:right;">
r.squared
</th>
<th style="text-align:right;">
adj.r.squared
</th>
<th style="text-align:right;">
sigma
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
<th style="text-align:right;">
df
</th>
<th style="text-align:right;">
logLik
</th>
<th style="text-align:right;">
AIC
</th>
<th style="text-align:right;">
BIC
</th>
<th style="text-align:right;">
deviance
</th>
<th style="text-align:right;">
df.residual
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
QUAL3
</td>
<td style="text-align:right;">
0.0033114
</td>
<td style="text-align:right;">
0.0013220
</td>
<td style="text-align:right;">
2.877734
</td>
<td style="text-align:right;">
1.664528
</td>
<td style="text-align:right;">
0.1975882
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-1244.397
</td>
<td style="text-align:right;">
2494.793
</td>
<td style="text-align:right;">
2507.455
</td>
<td style="text-align:right;">
4148.957
</td>
<td style="text-align:right;">
501
</td>
</tr>
<tr>
<td style="text-align:left;">
RENT3
</td>
<td style="text-align:right;">
0.0069421
</td>
<td style="text-align:right;">
0.0049599
</td>
<td style="text-align:right;">
2.466154
</td>
<td style="text-align:right;">
3.502292
</td>
<td style="text-align:right;">
0.0618665
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-1166.762
</td>
<td style="text-align:right;">
2339.524
</td>
<td style="text-align:right;">
2352.186
</td>
<td style="text-align:right;">
3047.041
</td>
<td style="text-align:right;">
501
</td>
</tr>
</tbody>
</table>
<pre class="r"><code># visualizando a analise de variancia do modelo
stat.test %&gt;% 
  select(ticker, lm.anova) %&gt;% 
  unnest(lm.anova) %&gt;% 
  kable(caption= &quot;Análise de variação&quot;) %&gt;%
  kable_styling(bootstrap_options = &quot;striped&quot;, full_width = F)</code></pre>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:fitAnova">Table 4: </span>Análise de variação
</caption>
<thead>
<tr>
<th style="text-align:left;">
ticker
</th>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
df
</th>
<th style="text-align:right;">
sumsq
</th>
<th style="text-align:right;">
meansq
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
QUAL3
</td>
<td style="text-align:left;">
price.delta
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
13.78455
</td>
<td style="text-align:right;">
13.784545
</td>
<td style="text-align:right;">
1.664528
</td>
<td style="text-align:right;">
0.1975882
</td>
</tr>
<tr>
<td style="text-align:left;">
QUAL3
</td>
<td style="text-align:left;">
Residuals
</td>
<td style="text-align:right;">
501
</td>
<td style="text-align:right;">
4148.95749
</td>
<td style="text-align:right;">
8.281352
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
RENT3
</td>
<td style="text-align:left;">
price.delta
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
21.30065
</td>
<td style="text-align:right;">
21.300652
</td>
<td style="text-align:right;">
3.502292
</td>
<td style="text-align:right;">
0.0618665
</td>
</tr>
<tr>
<td style="text-align:left;">
RENT3
</td>
<td style="text-align:left;">
Residuals
</td>
<td style="text-align:right;">
501
</td>
<td style="text-align:right;">
3047.04060
</td>
<td style="text-align:right;">
6.081917
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
<pre class="r"><code># coeficientes obtidos
stat.test %&gt;% 
  select(ticker, lm.coefs) %&gt;% 
  unnest(lm.coefs) %&gt;% 
  kable(caption=&quot;Coeficientes da regressão&quot;) %&gt;%
  kable_styling(bootstrap_options = &quot;striped&quot;, full_width = F)</code></pre>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:fitCoefs">Table 5: </span>Coeficientes da regressão
</caption>
<thead>
<tr>
<th style="text-align:left;">
ticker
</th>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
std.error
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
QUAL3
</td>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
21.368836
</td>
<td style="text-align:right;">
0.1283564
</td>
<td style="text-align:right;">
166.480526
</td>
<td style="text-align:right;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;">
QUAL3
</td>
<td style="text-align:left;">
price.delta
</td>
<td style="text-align:right;">
-0.447896
</td>
<td style="text-align:right;">
0.3471615
</td>
<td style="text-align:right;">
-1.290166
</td>
<td style="text-align:right;">
0.1975882
</td>
</tr>
<tr>
<td style="text-align:left;">
RENT3
</td>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
33.074075
</td>
<td style="text-align:right;">
0.1099886
</td>
<td style="text-align:right;">
300.704459
</td>
<td style="text-align:right;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;">
RENT3
</td>
<td style="text-align:left;">
price.delta
</td>
<td style="text-align:right;">
-0.423032
</td>
<td style="text-align:right;">
0.2260461
</td>
<td style="text-align:right;">
-1.871441
</td>
<td style="text-align:right;">
0.0618665
</td>
</tr>
</tbody>
</table>
<p>Então comparamos os <code>t-statistics</code> obtido para cada um dos coeficientes.</p>
<pre class="r"><code># isola o coeficient dos betas dos modelos
stat.test %&gt;% 
  select(ticker, lm.coefs) %&gt;% 
  unnest(lm.coefs) %&gt;% 
  select(ticker, term, estimate, statistic, p.value) %&gt;%
  filter( term!=&quot;(Intercept)&quot; ) %&gt;% 
  select(-term) %&gt;% 
  inner_join( count(df.tickers , ticker), by=&quot;ticker&quot;) -&gt; coefs

# mostra eles
coefs %&gt;% 
  kable(caption=&quot;Coeficientes da regressão&quot;) %&gt;%
  kable_styling(bootstrap_options = &quot;striped&quot;, full_width = F)</code></pre>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:tstats">Table 6: </span>Coeficientes da regressão
</caption>
<thead>
<tr>
<th style="text-align:left;">
ticker
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
QUAL3
</td>
<td style="text-align:right;">
-0.447896
</td>
<td style="text-align:right;">
-1.290166
</td>
<td style="text-align:right;">
0.1975882
</td>
<td style="text-align:right;">
504
</td>
</tr>
<tr>
<td style="text-align:left;">
RENT3
</td>
<td style="text-align:right;">
-0.423032
</td>
<td style="text-align:right;">
-1.871441
</td>
<td style="text-align:right;">
0.0618665
</td>
<td style="text-align:right;">
504
</td>
</tr>
</tbody>
</table>
<p>Para QUAL3 encontramos o valor de <strong>-1.29</strong> e para RENT3 encontramos <strong>-1.871</strong> para ~500 amostras. Ambos os valores estão abaixo (em módulo) dos valores de referência na tabela Dickey-Fuller (<strong>-2.87</strong>), mostrando que ambas as séries são “não-estacionárias”.</p>
</div>
</div>
<div id="teste-de-cointegracao-metodologia-de-engle-granger" class="section level2">
<h2>Teste de Cointegração (metodologia de Engle-Granger)</h2>
<p>A metodologia de <a href="https://www.empiwifo.uni-freiburg.de/lehre-teaching-1/winter-term/makrookonometrie/methodology.pdf">Engle-Granger</a> consiste em dois passos: primeiro fazemos uma regressão linear de uma série temporal contra a outra. Em seguida, aplicamos um teste de estacionariedade (como por exemplo o teste de Dickey-Fuller) nos resíduos desta regressão. Se os resíduos forem estacionários, isto significa que encontramos a combinação linear tal que as duas séries são cointegradas.</p>
<p>Então vamos avaliar a combinação linear entre QUAL3 e RENT3</p>
<pre class="r"><code>df.tickers %&gt;% 
  spread(key=ticker, value=price.close) %&gt;% 
  ggplot(aes(x=RENT3, y=QUAL3)) +
    geom_point(size=2, alpha=.5) + theme_light()</code></pre>
<p><img src="/post/2018-08-26-operando-long-short-usando-cointegracao-em-r_files/figure-html/plotCombinacao-1.png" width="672" /></p>
<pre class="r"><code># faz a composicao para detectar a cointegração
# fitando um modelo de um ativo contra outro
df.tickers %&gt;% 
  spread(key=ticker, value=price.close) %&gt;% # pivota para ref.date, qual3 e rent3
  lm(QUAL3 ~ RENT3, .) -&gt; coint # fita o modelo

# avalia valores obtidos no modelo
coint %&gt;%
  glance() %&gt;% 
  kable(caption = &quot;Qualidade da regressão&quot;) %&gt;%
  kable_styling(bootstrap_options = &quot;striped&quot;, full_width = F)</code></pre>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:cointegradion">Table 7: </span>Qualidade da regressão
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
r.squared
</th>
<th style="text-align:right;">
adj.r.squared
</th>
<th style="text-align:right;">
sigma
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
<th style="text-align:right;">
df
</th>
<th style="text-align:right;">
logLik
</th>
<th style="text-align:right;">
AIC
</th>
<th style="text-align:right;">
BIC
</th>
<th style="text-align:right;">
deviance
</th>
<th style="text-align:right;">
df.residual
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
value
</td>
<td style="text-align:right;">
0.7743701
</td>
<td style="text-align:right;">
0.7739206
</td>
<td style="text-align:right;">
1.369506
</td>
<td style="text-align:right;">
1722.882
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-872.6258
</td>
<td style="text-align:right;">
1751.252
</td>
<td style="text-align:right;">
1763.919
</td>
<td style="text-align:right;">
941.5243
</td>
<td style="text-align:right;">
502
</td>
</tr>
</tbody>
</table>
<pre class="r"><code># avalia dados de variancia
coint %&gt;%
  anova() %&gt;%
  tidy() %&gt;%  
  kable(caption = &quot;Análise de Variacao&quot;) %&gt;%
  kable_styling(bootstrap_options = &quot;striped&quot;, full_width = F)</code></pre>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:cointAnova">Table 8: </span>Análise de Variacao
</caption>
<thead>
<tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
df
</th>
<th style="text-align:right;">
sumsq
</th>
<th style="text-align:right;">
meansq
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
RENT3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3231.3452
</td>
<td style="text-align:right;">
3231.345212
</td>
<td style="text-align:right;">
1722.882
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Residuals
</td>
<td style="text-align:right;">
502
</td>
<td style="text-align:right;">
941.5243
</td>
<td style="text-align:right;">
1.875546
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
<pre class="r"><code># mostra os coeficientes do modelo
coint %&gt;% 
  tidy() %&gt;%  
  kable(caption = &quot;Coeficientes da Regressao&quot;) %&gt;%
  kable_styling(bootstrap_options = &quot;striped&quot;, full_width = F)</code></pre>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:cointCoefs">Table 9: </span>Coeficientes da Regressao
</caption>
<thead>
<tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
std.error
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
-12.466815
</td>
<td style="text-align:right;">
0.8174937
</td>
<td style="text-align:right;">
-15.25004
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
RENT3
</td>
<td style="text-align:right;">
1.022958
</td>
<td style="text-align:right;">
0.0246451
</td>
<td style="text-align:right;">
41.50761
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p>E aplicar teste DF nos resíduos da regressão.</p>
<pre class="r"><code># monta um dataset para avaliar os residuos
# nao eh necessario mas fica mais facil de visualizar
df.tickers %&gt;%
  filter( ticker==&quot;QUAL3&quot; ) %&gt;% 
  select(ticker, ref.date, price.close) %&gt;% 
  bind_cols(
    tibble(
      predicted = coint$fitted.values,
      residuals = coint$residuals
    )    
  ) %&gt;% 
  mutate( lagRes = lag(residuals,1),
          deltaRes = residuals - lagRes ) -&gt; coint.ds

# mosta os dados
coint.ds %&gt;% 
  head(10) %&gt;% 
  kable(caption = &quot;Preparacao dos Resíduos para fazer teste Dickey-Fuller&quot;) %&gt;%
  kable_styling(bootstrap_options = &quot;striped&quot;, full_width = F)</code></pre>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:cointDF">Table 10: </span>Preparacao dos Resíduos para fazer teste Dickey-Fuller
</caption>
<thead>
<tr>
<th style="text-align:left;">
ticker
</th>
<th style="text-align:left;">
ref.date
</th>
<th style="text-align:right;">
price.close
</th>
<th style="text-align:right;">
predicted
</th>
<th style="text-align:right;">
residuals
</th>
<th style="text-align:right;">
lagRes
</th>
<th style="text-align:right;">
deltaRes
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
QUAL3
</td>
<td style="text-align:left;">
2012-10-10
</td>
<td style="text-align:right;">
19.65
</td>
<td style="text-align:right;">
20.21976
</td>
<td style="text-align:right;">
-0.5697610
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
QUAL3
</td>
<td style="text-align:left;">
2012-10-11
</td>
<td style="text-align:right;">
19.70
</td>
<td style="text-align:right;">
20.50517
</td>
<td style="text-align:right;">
-0.8051662
</td>
<td style="text-align:right;">
-0.5697610
</td>
<td style="text-align:right;">
-0.2354053
</td>
</tr>
<tr>
<td style="text-align:left;">
QUAL3
</td>
<td style="text-align:left;">
2012-10-15
</td>
<td style="text-align:right;">
19.87
</td>
<td style="text-align:right;">
20.39469
</td>
<td style="text-align:right;">
-0.5246868
</td>
<td style="text-align:right;">
-0.8051662
</td>
<td style="text-align:right;">
0.2804795
</td>
</tr>
<tr>
<td style="text-align:left;">
QUAL3
</td>
<td style="text-align:left;">
2012-10-16
</td>
<td style="text-align:right;">
19.35
</td>
<td style="text-align:right;">
19.84229
</td>
<td style="text-align:right;">
-0.4922895
</td>
<td style="text-align:right;">
-0.5246868
</td>
<td style="text-align:right;">
0.0323973
</td>
</tr>
<tr>
<td style="text-align:left;">
QUAL3
</td>
<td style="text-align:left;">
2012-10-17
</td>
<td style="text-align:right;">
18.75
</td>
<td style="text-align:right;">
18.82956
</td>
<td style="text-align:right;">
-0.0795611
</td>
<td style="text-align:right;">
-0.4922895
</td>
<td style="text-align:right;">
0.4127284
</td>
</tr>
<tr>
<td style="text-align:left;">
QUAL3
</td>
<td style="text-align:left;">
2012-10-18
</td>
<td style="text-align:right;">
18.87
</td>
<td style="text-align:right;">
19.38196
</td>
<td style="text-align:right;">
-0.5119584
</td>
<td style="text-align:right;">
-0.0795611
</td>
<td style="text-align:right;">
-0.4323973
</td>
</tr>
<tr>
<td style="text-align:left;">
QUAL3
</td>
<td style="text-align:left;">
2012-10-19
</td>
<td style="text-align:right;">
19.00
</td>
<td style="text-align:right;">
19.46482
</td>
<td style="text-align:right;">
-0.4648180
</td>
<td style="text-align:right;">
-0.5119584
</td>
<td style="text-align:right;">
0.0471404
</td>
</tr>
<tr>
<td style="text-align:left;">
QUAL3
</td>
<td style="text-align:left;">
2012-10-22
</td>
<td style="text-align:right;">
19.20
</td>
<td style="text-align:right;">
19.76864
</td>
<td style="text-align:right;">
-0.5686365
</td>
<td style="text-align:right;">
-0.4648180
</td>
<td style="text-align:right;">
-0.1038185
</td>
</tr>
<tr>
<td style="text-align:left;">
QUAL3
</td>
<td style="text-align:left;">
2012-10-23
</td>
<td style="text-align:right;">
19.15
</td>
<td style="text-align:right;">
19.76864
</td>
<td style="text-align:right;">
-0.6186365
</td>
<td style="text-align:right;">
-0.5686365
</td>
<td style="text-align:right;">
-0.0500000
</td>
</tr>
<tr>
<td style="text-align:left;">
QUAL3
</td>
<td style="text-align:left;">
2012-10-24
</td>
<td style="text-align:right;">
19.99
</td>
<td style="text-align:right;">
19.11497
</td>
<td style="text-align:right;">
0.8750336
</td>
<td style="text-align:right;">
-0.6186365
</td>
<td style="text-align:right;">
1.4936701
</td>
</tr>
</tbody>
</table>
<pre class="r"><code># fit dos residuos
coint.ds %&gt;% 
  lm(lagRes ~ deltaRes, .) -&gt; coint.lm</code></pre>
<pre class="r"><code># avalia valores obtidos no modelo
coint.lm %&gt;%
  glance() %&gt;% 
  kable(caption = &quot;Qualidade da regressão&quot;) %&gt;%
  kable_styling(bootstrap_options = &quot;striped&quot;, full_width = F)</code></pre>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:resGlance">Table 11: </span>Qualidade da regressão
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
r.squared
</th>
<th style="text-align:right;">
adj.r.squared
</th>
<th style="text-align:right;">
sigma
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
<th style="text-align:right;">
df
</th>
<th style="text-align:right;">
logLik
</th>
<th style="text-align:right;">
AIC
</th>
<th style="text-align:right;">
BIC
</th>
<th style="text-align:right;">
deviance
</th>
<th style="text-align:right;">
df.residual
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
value
</td>
<td style="text-align:right;">
0.0405699
</td>
<td style="text-align:right;">
0.0386549
</td>
<td style="text-align:right;">
1.341484
</td>
<td style="text-align:right;">
21.18501
</td>
<td style="text-align:right;">
5.3e-06
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-860.4938
</td>
<td style="text-align:right;">
1726.988
</td>
<td style="text-align:right;">
1739.649
</td>
<td style="text-align:right;">
901.5899
</td>
<td style="text-align:right;">
501
</td>
</tr>
</tbody>
</table>
<pre class="r"><code># variancia do modelo dos residuos
coint.lm %&gt;%
  anova() %&gt;%
  tidy() %&gt;%  
  kable(caption = &quot;Análise de Variacao&quot;) %&gt;%
  kable_styling(bootstrap_options = &quot;striped&quot;, full_width = F)</code></pre>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:resAnova">Table 12: </span>Análise de Variacao
</caption>
<thead>
<tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
df
</th>
<th style="text-align:right;">
sumsq
</th>
<th style="text-align:right;">
meansq
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
deltaRes
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
38.12413
</td>
<td style="text-align:right;">
38.124130
</td>
<td style="text-align:right;">
21.18501
</td>
<td style="text-align:right;">
5.3e-06
</td>
</tr>
<tr>
<td style="text-align:left;">
Residuals
</td>
<td style="text-align:right;">
501
</td>
<td style="text-align:right;">
901.58992
</td>
<td style="text-align:right;">
1.799581
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
<pre class="r"><code># coeficientes do modelo dos residuos
coint.lm %&gt;% 
  tidy() %&gt;%  
  kable(caption = &quot;Coeficientes da Regressao&quot;) %&gt;%
  kable_styling(bootstrap_options = &quot;striped&quot;, full_width = F)</code></pre>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:resCoef">Table 13: </span>Coeficientes da Regressao
</caption>
<thead>
<tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
std.error
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.0019098
</td>
<td style="text-align:right;">
0.0598141
</td>
<td style="text-align:right;">
0.0319291
</td>
<td style="text-align:right;">
0.9745413
</td>
</tr>
<tr>
<td style="text-align:left;">
deltaRes
</td>
<td style="text-align:right;">
-0.4952238
</td>
<td style="text-align:right;">
0.1075938
</td>
<td style="text-align:right;">
-4.6027174
</td>
<td style="text-align:right;">
0.0000053
</td>
</tr>
</tbody>
</table>
<pre class="r"><code># usado para mostrar no texto
tstat &lt;- coint.lm %&gt;% tidy %&gt;% filter(term==&quot;deltaRes&quot;) %&gt;% pull(statistic)</code></pre>
<p>Desta vez, o <code>t-stat</code> obtido foi de <strong>-4.603</strong>, muito além (em módulo) dos valores para a tabela de significância para 500 ou mais amostras (<strong>-2.87</strong>). Neste caso confirmando que a hipótese de que a série é estacionária, e portanto os pares estão cointegrados.</p>
</div>
<div id="trading-long-short" class="section level2">
<h2>Trading Long-Short</h2>
<div id="spread" class="section level3">
<h3>Spread</h3>
<p>O gráfico abaixo apresenta a evolução do <em>spread</em> ao longo do tempo, com duas bandas representando -2 e 2 vezes o desvio padrão dos resíduos. Vemos que, apesar de os resíduos apresentarem certa persistência, comportam-se de maneira aparentemente desejável: flutuam razoavelmente ao redor da média, visitando-a com certa frequência.</p>
<pre class="r"><code># plot

# banda +/- 2 SD
sd.res &lt;- sd(coint.ds$residuals)

# residuos e banda
coint.ds %&gt;% 
  ggplot(aes(x=ref.date, y=residuals)) + 
  geom_line(color=&quot;blue&quot;,size=1) +
  geom_hline(yintercept =  2*sd.res, color=&quot;red&quot;, linetype=2) +
  geom_hline(yintercept = -2*sd.res, color=&quot;red&quot;, linetype=2) +
  theme_light()</code></pre>
<p><img src="/post/2018-08-26-operando-long-short-usando-cointegracao-em-r_files/figure-html/spreadPlot-1.png" width="672" /></p>
<p>Uma regra possível de operação consistiria em vender o par quando o resíduo estiver acima da banda, e comprar o par quando estiver abaixo da banda. O trade pode ser encerrado quando o par voltar a média ou a um percentual qualquer da média.</p>
</div>
<div id="detectando-operacoes" class="section level3">
<h3>Detectando Operações</h3>
<p>Seguindo a estratégia acima, usamos as transições de banda e pela média para detectar os pontos de entrada e saída de operações long e short.</p>
<pre class="r"><code># estrategia de negociacao, abrir ao -/+ 2 * sd e fechar no 0
startPar &lt;- 2*sd.res
closePar &lt;- 0

# detecta os pontos de entrada e saida nas operacoes de short
coint.ds %&gt;% 
  mutate(operation=case_when(
    lagRes &lt; startPar &amp; residuals &gt;= startPar   ~ &quot;short_start&quot;, # cruzou o gatilho de start
    lagRes &gt; closePar &amp; residuals &lt;= closePar    ~ &quot;short_stop&quot;  # cruzou o gatilho de stop
  )) %&gt;%
  filter( !is.na(operation) ) %&gt;% 
  # elminia cruzamentos duplicado (quando a operacao ja esta aberta)
  mutate( operation.lag = lag(operation,1) ) %&gt;% 
  select( ref.date, residuals, lagRes, operation, operation.lag ) %&gt;% 
  filter( operation!=operation.lag ) %&gt;% 
  select( -operation.lag) -&gt; ops.short

# detecta pontos de entrada e saida nas operacoes de long
coint.ds %&gt;% 
  mutate(operation=case_when(
    lagRes &gt; -startPar &amp; residuals &lt;= -startPar ~ &quot;long_start&quot;,
    lagRes &lt; -closePar &amp; residuals &gt;= -closePar ~ &quot;long_stop&quot;
  )) %&gt;%
  filter( !is.na(operation) ) %&gt;% 
  mutate( operation.lag = lag(operation,1) ) %&gt;% 
  select( ref.date, residuals, lagRes, operation, operation.lag ) %&gt;% 
  filter( operation!=operation.lag ) %&gt;% 
  select( -operation.lag) -&gt; ops.long

# junta as operacoes
operations &lt;- bind_rows(ops.short, ops.long)

# residuos e banda
coint.ds %&gt;% 
  ggplot(aes(x=ref.date, y=residuals)) + 
  geom_line(color=&quot;blue&quot;,size=1, alpha=0.3) +
  geom_hline(yintercept =  startPar, color=&quot;red&quot;, linetype=2, alpha=0.5) +
  geom_hline(yintercept =  closePar, color=&quot;blue&quot;, linetype=2, alpha=0.5) +
  geom_hline(yintercept = -closePar, color=&quot;blue&quot;, linetype=2, alpha=0.5) +
  geom_hline(yintercept = -startPar, color=&quot;red&quot;, linetype=2, alpha=0.5) +
  geom_vline(data=operations, 
             mapping=aes(xintercept = ref.date, color=operation),
             size=1, linetype=1) +
  theme_light() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())</code></pre>
<p><img src="/post/2018-08-26-operando-long-short-usando-cointegracao-em-r_files/figure-html/startOperations-1.png" width="672" /></p>
<p>A partir dos pontos de entrada e saída do par detectados, podemos então compor a série de operações.</p>
<pre class="r"><code># junta os pares operados  pares
operations %&gt;% 
  arrange(ref.date) %&gt;% 
  mutate( opLag = lead(operation, 1),
          open=ref.date,
          close = lead(ref.date,1) ) %&gt;% 
  filter( (operation==&quot;short_start&quot; &amp; opLag==&quot;short_stop&quot;) |
          (operation==&quot;long_start&quot; &amp; opLag==&quot;long_stop&quot;) ) %&gt;% 
  select(-ref.date, -residuals, -lagRes, -opLag) %&gt;% 
  mutate( operation=case_when(
    operation==&quot;short_start&quot; ~ &quot;short&quot;,
    operation==&quot;long_start&quot;  ~ &quot;long&quot;
  ) ) %&gt;% 
  mutate( life.span = round(lubridate::interval(open, close)/days(1)) )-&gt; operations

operations %&gt;%  
  kable(caption = &quot;Operacoes Cointegradas&quot;) %&gt;%
  kable_styling(bootstrap_options = &quot;striped&quot;, full_width = F)</code></pre>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:ops">Table 14: </span>Operacoes Cointegradas
</caption>
<thead>
<tr>
<th style="text-align:left;">
operation
</th>
<th style="text-align:left;">
open
</th>
<th style="text-align:left;">
close
</th>
<th style="text-align:right;">
life.span
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
short
</td>
<td style="text-align:left;">
2012-11-12
</td>
<td style="text-align:left;">
2012-11-29
</td>
<td style="text-align:right;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
long
</td>
<td style="text-align:left;">
2013-02-13
</td>
<td style="text-align:left;">
2013-02-20
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
long
</td>
<td style="text-align:left;">
2013-07-11
</td>
<td style="text-align:left;">
2013-08-20
</td>
<td style="text-align:right;">
40
</td>
</tr>
<tr>
<td style="text-align:left;">
short
</td>
<td style="text-align:left;">
2014-02-04
</td>
<td style="text-align:left;">
2014-02-18
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:left;">
short
</td>
<td style="text-align:left;">
2014-03-07
</td>
<td style="text-align:left;">
2014-04-22
</td>
<td style="text-align:right;">
46
</td>
</tr>
</tbody>
</table>
<p>Com a tabela de operações, podemos simular os ganhos de operação, lembrando que quando o par é vendido abre-se simultaneamente uma posição vendida na primeira ação e comprada na segunda ação e a operação oposta é realizada quando o par é comprado.</p>
<p>Neste sentido vamos recuperar os valores da cotação de QUAL3 e RENT3 nas datas de abertura e fechamento de operações.</p>
<pre class="r"><code># precos de abertura
operations %&gt;%
  select( open ) %&gt;% 
  inner_join(df.tickers, by=c(&quot;open&quot;=&quot;ref.date&quot;)) %&gt;% 
  spread(key = ticker, value=price.close) %&gt;% 
  set_names(c(&quot;open&quot;,&quot;QUAL3.SA.OPEN&quot;,&quot;RENT3.SA.OPEN&quot;)) -&gt; prices.open

# precos de fechamento
operations %&gt;%
  select( close ) %&gt;% 
  inner_join(df.tickers, by=c(&quot;close&quot;=&quot;ref.date&quot;)) %&gt;% 
  spread(key = ticker, value=price.close) %&gt;% 
  set_names(c(&quot;close&quot;,&quot;QUAL3.SA.CLOSE&quot;,&quot;RENT3.SA.CLOSE&quot;)) -&gt; prices.close

# monta operacao + precos
operations %&gt;%
  inner_join(prices.open, by=&quot;open&quot;) %&gt;% 
  inner_join(prices.close, by=&quot;close&quot;) -&gt; op.results

op.results %&gt;% 
  kable(caption = &quot;Cotações do par integrado&quot;) %&gt;%
  kable_styling(bootstrap_options = &quot;striped&quot;, full_width = F)</code></pre>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-1">Table 15: </span>Cotações do par integrado
</caption>
<thead>
<tr>
<th style="text-align:left;">
operation
</th>
<th style="text-align:left;">
open
</th>
<th style="text-align:left;">
close
</th>
<th style="text-align:right;">
life.span
</th>
<th style="text-align:right;">
QUAL3.SA.OPEN
</th>
<th style="text-align:right;">
RENT3.SA.OPEN
</th>
<th style="text-align:right;">
QUAL3.SA.CLOSE
</th>
<th style="text-align:right;">
RENT3.SA.CLOSE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
short
</td>
<td style="text-align:left;">
2012-11-12
</td>
<td style="text-align:left;">
2012-11-29
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
22.40
</td>
<td style="text-align:right;">
31.017
</td>
<td style="text-align:right;">
19.99
</td>
<td style="text-align:right;">
32.511
</td>
</tr>
<tr>
<td style="text-align:left;">
long
</td>
<td style="text-align:left;">
2013-02-13
</td>
<td style="text-align:left;">
2013-02-20
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
19.50
</td>
<td style="text-align:right;">
34.582
</td>
<td style="text-align:right;">
21.50
</td>
<td style="text-align:right;">
32.914
</td>
</tr>
<tr>
<td style="text-align:left;">
long
</td>
<td style="text-align:left;">
2013-07-11
</td>
<td style="text-align:left;">
2013-08-20
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
15.03
</td>
<td style="text-align:right;">
30.311
</td>
<td style="text-align:right;">
17.37
</td>
<td style="text-align:right;">
29.026
</td>
</tr>
<tr>
<td style="text-align:left;">
short
</td>
<td style="text-align:left;">
2014-02-04
</td>
<td style="text-align:left;">
2014-02-18
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
21.00
</td>
<td style="text-align:right;">
29.657
</td>
<td style="text-align:right;">
19.60
</td>
<td style="text-align:right;">
31.387
</td>
</tr>
<tr>
<td style="text-align:left;">
short
</td>
<td style="text-align:left;">
2014-03-07
</td>
<td style="text-align:left;">
2014-04-22
</td>
<td style="text-align:right;">
46
</td>
<td style="text-align:right;">
20.85
</td>
<td style="text-align:right;">
29.806
</td>
<td style="text-align:right;">
22.47
</td>
<td style="text-align:right;">
34.571
</td>
</tr>
</tbody>
</table>
<p>É possível visualizar as operações de cada um dos ativos na cotação dos mesmos.</p>
<pre class="r"><code># plota os ativos e as operacoes
ggplot() +
  geom_line(data=df.tickers, 
            aes(x=ref.date, y=price.close, color=ticker),size=1) +
  geom_rect(data=op.results,
            aes(xmin=open, ymin=QUAL3.SA.OPEN,
                xmax=close, ymax=QUAL3.SA.CLOSE,
                fill=ifelse(QUAL3.SA.OPEN&lt;QUAL3.SA.CLOSE,&quot;green&quot;,&quot;purple&quot;)),
                alpha=0.35, show.legend = F) +
    geom_rect(data=op.results,
            aes(xmin=open, ymin=RENT3.SA.OPEN,
                xmax=close, ymax=RENT3.SA.CLOSE,
                fill=ifelse(RENT3.SA.OPEN&lt;RENT3.SA.CLOSE,&quot;green&quot;,&quot;purple&quot;)),
                alpha=0.35, show.legend = F) +
  theme_light() </code></pre>
<p><img src="/post/2018-08-26-operando-long-short-usando-cointegracao-em-r_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>Com as cotações na mão vamos simular uma operação cointegrada com cash neutro, ou seja, o volume financeiro comprado é o mesmo valor vendido, nesta simulação usaremos R$1000,00 em cada uma dos dois ativos, e vamos avaliar o rendimento das mesmas.</p>
<pre class="r"><code># define o capital investido
k &lt;- 2000

# calculo dos rendimentos
op.results %&gt;% 
  # calcula o volume de cada ativo comprado/vendido correspondente ao valor do capital
  mutate( vol.qual3 = round(0.5*k/QUAL3.SA.OPEN),
          vol.rent3 = round(0.5*k/RENT3.SA.OPEN) ) %&gt;% 
  # calcula o saldo $$ entre vendido e comprado dependendo da direção da operação
  mutate( entrada = case_when(
    operation == &quot;short&quot; ~ round(vol.qual3*QUAL3.SA.OPEN-vol.rent3*RENT3.SA.OPEN,2),
    operation == &quot;long&quot;  ~ round(vol.rent3*RENT3.SA.OPEN-vol.qual3*QUAL3.SA.OPEN,2)
  )) %&gt;% 
  # calcula o saldo $$ para fechar a operação
  mutate( saida = case_when(
    operation == &quot;short&quot; ~ round(vol.rent3*RENT3.SA.CLOSE-vol.qual3*QUAL3.SA.CLOSE,2),
    operation == &quot;long&quot;  ~ round(vol.qual3*QUAL3.SA.CLOSE-vol.rent3*RENT3.SA.CLOSE,2)
  )) %&gt;% 
  # calcula o retorno em função do capital total investido
  mutate(
    retorno = (saida-entrada)/k
  ) -&gt; results

results %&gt;% 
  select(operation, open, close, entrada, saida, retorno) %&gt;% 
  kable(caption = &quot;Retorno obtido&quot;) %&gt;%
  kable_styling(bootstrap_options = &quot;striped&quot;, full_width = F)</code></pre>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:cashNeutro">Table 16: </span>Retorno obtido
</caption>
<thead>
<tr>
<th style="text-align:left;">
operation
</th>
<th style="text-align:left;">
open
</th>
<th style="text-align:left;">
close
</th>
<th style="text-align:right;">
entrada
</th>
<th style="text-align:right;">
saida
</th>
<th style="text-align:right;">
retorno
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
short
</td>
<td style="text-align:left;">
2012-11-12
</td>
<td style="text-align:left;">
2012-11-29
</td>
<td style="text-align:right;">
15.46
</td>
<td style="text-align:right;">
140.80
</td>
<td style="text-align:right;">
0.062670
</td>
</tr>
<tr>
<td style="text-align:left;">
long
</td>
<td style="text-align:left;">
2013-02-13
</td>
<td style="text-align:left;">
2013-02-20
</td>
<td style="text-align:right;">
8.38
</td>
<td style="text-align:right;">
141.99
</td>
<td style="text-align:right;">
0.066805
</td>
</tr>
<tr>
<td style="text-align:left;">
long
</td>
<td style="text-align:left;">
2013-07-11
</td>
<td style="text-align:left;">
2013-08-20
</td>
<td style="text-align:right;">
-6.75
</td>
<td style="text-align:right;">
205.93
</td>
<td style="text-align:right;">
0.106340
</td>
</tr>
<tr>
<td style="text-align:left;">
short
</td>
<td style="text-align:left;">
2014-02-04
</td>
<td style="text-align:left;">
2014-02-18
</td>
<td style="text-align:right;">
-0.34
</td>
<td style="text-align:right;">
126.36
</td>
<td style="text-align:right;">
0.063350
</td>
</tr>
<tr>
<td style="text-align:left;">
short
</td>
<td style="text-align:left;">
2014-03-07
</td>
<td style="text-align:left;">
2014-04-22
</td>
<td style="text-align:right;">
-12.60
</td>
<td style="text-align:right;">
96.85
</td>
<td style="text-align:right;">
0.054725
</td>
</tr>
</tbody>
</table>
<p>Vale ressaltar que as <code>entradas</code> mostrados na tabela corresponde a diferença ao balanço líquido de capital, já que nem sempre é possível “casar” exatamente o mesmo valor dado o valor unitário das ações. Já as <code>saídas</code> corresponde saldo obtido para zerar as operações de long+short, o que em tese, corresponde o ganho obtido.</p>
<p>Já o <code>rendimento</code> é calculado com base no valor obtido sobre o capital total investido, na nossa simulação R$2000,00, ou seja, R$1000,00 para cada operação e o resultado total:</p>
<pre class="r"><code>results %&gt;% 
  summarise( saldoEntrada = sum(entrada,na.rm = T),
             saldoSaida   = sum(saida,na.rm = T)) %&gt;% 
  t() %&gt;% 
  kable(caption=&quot;Resultado&quot;) %&gt;% 
  kable_styling(bootstrap_options = &quot;striped&quot;, full_width = F)</code></pre>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:totalResult">Table 17: </span>Resultado
</caption>
<tbody>
<tr>
<td style="text-align:left;">
saldoEntrada
</td>
<td style="text-align:right;">
4.15
</td>
</tr>
<tr>
<td style="text-align:left;">
saldoSaida
</td>
<td style="text-align:right;">
711.93
</td>
</tr>
</tbody>
</table>
<p>Como simulamos as operações usando a estratégia <a href="https://www.investopedia.com/terms/c/cash-neutral.asp"><em>cash-neutral</em></a>, em teoria poderíamos manter o capital total investido em Tesouro Direto, LCAs ou LCI e usá-lo como garantia, permitindo assim que as operações pudessem sere feitas com muito pouco dinheiro investido. No cenário simulado foi possível obter cerca de R$700,00 dos R$2000,00 reais em uma janela de dois anos (35% de rendimento bruto), o que parece bem promissor.</p>
<p>Cabe lembrar que não acrescentamos os custos de operação, do aluguel de ações ou de tributos, o que poderiam alterar significativamente o resultado final. Tema esse que ficará para um próximo post.</p>
</div>
</div>
<div id="conclusao" class="section level2">
<h2>Conclusão</h2>
<p>No contexto de operações com pares de ativos (<em>pair trading</em>), a existência de uma relação de cointegração entre as séries de preços de dois ativos significa que pode ser possível realizar operações lucrativas de arbitragem. Reproduzimos neste <a href="https://rmarkdown.rstudio.com/r_notebooks">R-Notebook</a> o passo-a-passo para encontrar ativos financeiros cointegrados e identificar os pontos de entrada de operações Long e Short, bem como, avaliar os resultados dessa estratégia de investimento num modelo simplificado.</p>
</div>
<div id="referencias" class="section level2">
<h2>Referências</h2>
<ol style="list-style-type: decimal">
<li>Moura, Guilherme V. e Caldeira, João F. - <strong>Seleção de uma Carteira de Pares de Ações Usando Cointegração: Uma Estrategia de Arbitragem Estatística</strong> - <a href="https://www.scribd.com/document/237462625/4785-19806-1-PB" class="uri">https://www.scribd.com/document/237462625/4785-19806-1-PB</a></li>
<li>Caldeira, João F. - <strong>Arbitragem Estatística, Estratégia Long-Short Pairs Trading, Abordagem com Cointegração Aplicada ao Mercado de Ações Brasileiro</strong> - <a href="http://www.anpec.org.br/revista/vol14/vol14n1p521_546.pdf" class="uri">http://www.anpec.org.br/revista/vol14/vol14n1p521_546.pdf</a></li>
<li><a href="https://drnickel.wordpress.com/">Blog do Dr. Nickel</a> - <strong>Long-Short através de Cointegração</strong> – <a href="https://drnickel.wordpress.com/2015/03/15/long-short-atraves-de-cointegracao-parte-1/">Parte 1</a>, <a href="https://drnickel.wordpress.com/2015/03/15/long-short-atraves-de-cointegracao-parte-2/">Parte 2</a>, <a href="https://drnickel.wordpress.com/2015/04/03/long-short-atraves-de-cointegracao-parte-3/">Parte 3</a> e <a href="https://drnickel.wordpress.com/2016/11/05/long-short-atraves-de-cointegracao-parte-4/">Parte 4</a></li>
<li><a href="https://www.quantstart.com/">QuantStart</a> - Cointegrated Time Series Analysis for Mean Reversion Trading with R - <a href="https://www.quantstart.com/articles/Cointegrated-Time-Series-Analysis-for-Mean-Reversion-Trading-with-R" class="uri">https://www.quantstart.com/articles/Cointegrated-Time-Series-Analysis-for-Mean-Reversion-Trading-with-R</a></li>
</ol>
</div>

              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="/tags/evalutation/">evalutation</a>

  <a class="tag tag--primary tag--small" href="/tags/long-short/">long short</a>

  <a class="tag tag--primary tag--small" href="/tags/model/">model</a>

  <a class="tag tag--primary tag--small" href="/tags/pair-trading/">pair trading</a>

  <a class="tag tag--primary tag--small" href="/tags/rstats/">rstats</a>

  <a class="tag tag--primary tag--small" href="/tags/stock-market/">stock market</a>

  <a class="tag tag--primary tag--small" href="/tags/pt-br/">pt-BR</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="/2018/10/forecasting-fantasy-games-using-monte-carlo-simulations/" data-tooltip="Forecasting Fantasy Games Using Monte Carlo Simulations">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="/2018/07/forecasting-my-weight-using-facebook-s-prophet/" data-tooltip="Using Facebook&#39;s Prophet to forecast my weight loss">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=/2018/08/operando-long-short-usando-cointegracao-em-r/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=/2018/08/operando-long-short-usando-cointegracao-em-r/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=/2018/08/operando-long-short-usando-cointegracao-em-r/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2019 Giuliano Sposito. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
        <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="/2018/10/forecasting-fantasy-games-using-monte-carlo-simulations/" data-tooltip="Forecasting Fantasy Games Using Monte Carlo Simulations">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="/2018/07/forecasting-my-weight-using-facebook-s-prophet/" data-tooltip="Using Facebook&#39;s Prophet to forecast my weight loss">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=/2018/08/operando-long-short-usando-cointegracao-em-r/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=/2018/08/operando-long-short-usando-cointegracao-em-r/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=/2018/08/operando-long-short-usando-cointegracao-em-r/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="5">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=%2F2018%2F08%2Foperando-long-short-usando-cointegracao-em-r%2F">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=%2F2018%2F08%2Foperando-long-short-usando-cointegracao-em-r%2F">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=%2F2018%2F08%2Foperando-long-short-usando-cointegracao-em-r%2F">
          <i class="fa fa-google-plus"></i><span>Share on Google&#43;</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.gravatar.com/avatar/2adfb1930aa9591ea756b0d94ca3603b?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Giuliano Sposito</h4>
    
      <div id="about-card-bio">Computer Engineer<br/>Masters in Tech Innovation Mgt<br/>Specialized in Data Science</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Manager<br/><a href="http://www.ciandt.com">CI&amp;T</a>
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Brazil
      </div>
    
  </div>
</div>

    

    
  
    
      
      <div id="cover" style="background-image:url('/images/new_cover_emboss.jpg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="/js/script-pcw6v3xilnxydl1vddzazdverrnn9ctynvnxgwho987mfyqkuylcb1nlt.min.js"></script>


<script lang="javascript">
window.onload = updateMinWidth;
window.onresize = updateMinWidth;
document.getElementById("sidebar").addEventListener("transitionend", updateMinWidth);
function updateMinWidth() {
  var sidebar = document.getElementById("sidebar");
  var main = document.getElementById("main");
  main.style.minWidth = "";
  var w1 = getComputedStyle(main).getPropertyValue("min-width");
  var w2 = getComputedStyle(sidebar).getPropertyValue("width");
  var w3 = getComputedStyle(sidebar).getPropertyValue("left");
  main.style.minWidth = `calc(${w1} - ${w2} - ${w3})`;
}
</script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  
    
      <script>
        var disqus_config = function () {
          this.page.url = '\/2018\/08\/operando-long-short-usando-cointegracao-em-r\/';
          
            this.page.identifier = '\/2018\/08\/operando-long-short-usando-cointegracao-em-r\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'yet-another-iteration';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  




    
  </body>
</html>

